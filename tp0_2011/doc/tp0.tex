\documentclass[a4paper,10pt]{article}
% Paquete para inclusión de gráficos.
\usepackage{graphicx}
% Paquete para definir la codificación del conjunto de caracteres usado
% (latin1 es ISO 8859-1).
\usepackage[latin1]{inputenc}
% Paquete para definir el idioma usado.
\usepackage[spanish]{babel}
\usepackage{hyperref}


% Título principal del documento.
\title{	\ Trabajo Práctico Nº 0: Infraestructura Básica}
% Información sobre los autores.
\author{	Martinez Ariel, \textit{Padrón Nro. 88573}\\
            \texttt{ lamc1986@yahoo.com.ar }\\\\
            Nestor Huallpa, \textit{Padrón Nro. }\\
            \texttt{ aliluis@gmail.com }\\\\
			Facundo Caldora, \textit{Padrón Nro. }\\
            \texttt{ dworja@hotmail.com }\\\\               
            \texttt{\footnotesize 1º Entrega: 08/09/2015}\\
            \\\\\\\\\\\\\\\\\\
            \normalsize{2do. Cuatrimestre de 2015}\\ 
            \normalsize{66.20 Organización de Computadoras} \\
            \normalsize{Facultad de Ingeniería, Universidad de Buenos Aires} \\}
       
\date{}


\begin{document}
% Inserta el título.
\maketitle
% quita el número en la primer página
\thispagestyle{empty}
% Resumen
\begin{abstract}
En el presente trabajo práctico se describirán todos los pasos y 
conclusiones relacionadas al desarrollo e implementación de multiplicacion de matrices de numero reales, representados
en punto flotante de doble precisiòn.
\end{abstract}
\newpage{}
\tableofcontents
\newpage{}

\begin{flushleft}

\par\end{flushleft}
\section{{\normalsize Introducción}}

\htmladdnormallink{Tac}{http://linux.die.net/man/1/tac} 
(tac en el entorno Linux) es un programa que nos permite ver un 
archivo línea por línea en orden inverso (desde el final hacia el 
principio). Concatena archivos y los imprime (por salida estándar) 
en forma inversa. Tac recibe el/los nombre/s de el/los archivos a 
procesar. Cuando no se le pasa ningún nombre o bien cuando el 
nombre del archivo es - significa que va a leer de la entrada 
estándar (stdin).


\section{{\normalsize Implementación}}

\subsection{{\normalsize Lenguaje}}

Como lenguaje de implementación se eligió ANSI C  \cite{Kernighan+Ritchie}
ya que el mismo permite una alta portabilidad entre diferentes plataformas. 
El desarrollo del programa se realizó usando un editor de texto 
(gedit,vim, kwrite) y compilando los archivos fuente con 
\htmladdnormallink{GCC}{http://gcc.gnu.org/} que viene en linux 
(probado en Ubuntu y Fedora 12). También una parte se desarrollo 
usando el IDE \htmladdnormallink{Eclipse}{http://www.eclipse.org/cdt/} con su 
respectivo plugin para C/C++ y se comprobó que dicho programa
compile con el \htmladdnormallink{GCC}{http://gcc.gnu.org/} que 
viene dentro de NETBSD, y como adicional, también se comprobó que 
el mismo compile y funcione en Windows por medio del 
\htmladdnormallink{MinGW}{http://www.mingw.org} el cual es una 
implemetación de los compiladores 
\htmladdnormallink{GCC}{http://gcc.gnu.org/} para la plataforma 
Win32 que permite migrar la capacidad de este compilador en 
entornos windows.
La compilación en Linux y en \texttt{BSD, MIPS} se realizó con la 
siguiente línea de comando:

\textbf{\emph{gcc -Wall -ansi -O0 -o tp0 Definitions.c Message.c  
Process\_File.c Process\_Stdin.c Stack.c tp0.c}}


\subsection {{\normalsize Descripción del programa}}

Cuando se pasa un nombre como argumento, se verifica que dicho nombre 
que está haciendo referencia a un archivo, verdaderamente haga referencia 
a un archivo (.txt, .dat etc (\htmladdnormallink{Regular File}{http://en.wikipedia.org/wiki/Unix_file_types\#Regular_file})) 
y no a un archivo de directorio, un archivo de dispositivo etc. Una 
vez hecha la verificación el programa se dispone a leer cada una de 
las líneas desde el final hacia el principio y las vuelca por salida 
estándar (stdout). En caso que las lineas provengan del stdin, 
se utiliza un buffer de memoria dinámica que almacena todas las lineas.\\
La función \texttt{main} se encuentra en \texttt{tp0.c} y se encarga de 
interpretar las opciones y argumentos. En caso de ser una opción, 
como ayuda o versión, se imprime el mensaje correspondiente y finaliza
la ejecución. Cuando no es una opción de ayuda o versión, se procede 
a procesar los datos de entrada, ya sean provenientes del stdin o de 
archivos. De acuerdo a cuál sea el caso, se utilizan las funciones 
Process\_Stdin ó Process\_File . La salida de estas funciones proveen 
un codigo de error que sirve como salida del programa. Los mensajes de 
versión y ayuda se imprimen por salida estándar (stdout) y el programa 
finaliza devolviendo 0 (cero) al sistema. Los mensajes de error se 
imprimen por la salida de errores (stderr) y el programa finaliza 
devolviendo 1 (uno) al sistema.

\subsubsection{{\normalsize Funciones del programa}}

El programa cuenta con una serie de funciones las cuales hacen al
funcionamiento principal del mismo, como a otros aspectos 
relacionados a brindar facilidad de uso al usuario dándole toda 
la información necesaria para su correcto uso.

\paragraph{int Process\_File(char{*} filename,int argc,int idx):} Procesa el archivo cuyo nombre es pasado en filename.
Los valores de retorno en caso de error pueden ser los siguientes{:} Devuelve -1 si el archivo es inexistente o cualquier fallo de la función stat(). Devuelve 0 si no es un archivo regular.
\paragraph{int Process\_Stdin():} Procesa la entrada estándar. Devuelve 1 si el procesamiento es satisfactorio. En caso contrario
devuelve un número disitinto de 1. 
\paragraph{bool Is\_Stdin(int idx,int argc,char{*} filename):} Devuelve true si se va a procesar la entrada estándar o false en caso de que se trate de un archivo
\paragraph{bool Is\_Option(char{*} opt):} Devuelve true si el puntero a caracter apunta a alguna de las opciones (--help -h, -V --Version), sino false.
\paragraph{void Print\_Option\_Msg(char{*} opt):} Imprime el mensaje de ayuda o el mensaje de versión según corresponda, de acuerdo al valor al que hace referencia opt.
\paragraph{int ERROR\_MSJ(int code):} Imprime un mensaje de error por stderr. El mensaje impreso depende del valor de code. El valor de retorno es 1.
\paragraph{int is\_regular(const char* filename):} Determina si el nombre al que apunta filename es un archivo regular o no. El valor de retorno puede ser -1 si no existe el archivo (o directorio), un valor distinto de 0 (cero) si es un archivo regular o 0 si no lo es.
\paragraph{void create(Type\_Stack{*} ptr\_Stack):} Crea una pila vacia
\paragraph{bool empty(Type\_Stack{*} ptr\_Stack):} Devuelve true si la pila a la que apunta ptr\_Stack esta vacía, sino false.
\paragraph{int push(Type\_Stack{*} ptr\_Stack,char{*} line):} Inserta el puntero a caracter al tope de la pila 
\paragraph{void pop(Type\_Stack{*} ptr\_Stack):} Elimina el tope de la pila
\paragraph{char* top(Type\_Stack{*} ptr\_Stack):} Devuelve  el contenido del tope de la pila
\paragraph{void destroy(Type\_Stack{*} ptr\_Stack):} Destruye la pila.
\paragraph{int main(int argc, char{*} argv{[}]):} Es la entrada principal
al programa y el que contiene toda la lógica necesaria para procesar los archivos y/o entrada estándar

\subsubsection {{\normalsize Errores posibles}}

\begin{enumerate}
\item El procesamiento de la entrada estándar causó el agotamiento del heap.
\item La invocación del programa es incorrecta.
\item Alguno de los archivos no es un archivo regular.
\item Alguno de los archivos es inexistente.
\end{enumerate}

Se contemplan otros errores gracias al uso de la variable externa errno. 
Cuando ocurre un error inesperado, el mismo es informado por stderr 
(con la funión perror()).

\subsection{{\normalsize Desarrollo de actividades}}

\begin{enumerate}
\item Se instaló en un linux un repositorio de fuentes 
\htmladdnormallink{(SVN)}{http://es.wikipedia.org/wiki/Subversion}
para que al dividir las tareas del TP se pudiese hacer una unión de
los cambios ingresados por cada uno de los integrantes más fácilmente. 
\item Cada persona del grupo se comprometió a que sus cambios en el el código
fuente y los cambios obtenidos del SVN que pudiesen haber subido los
otros integrantes del grupo, sean compilados en diferentes sistemas
operativos: Windows, Linux y el GXEmul, asegurando así la máxima portabilidad
entre plataformas planteada en el enunciado. 
\item Se estableció que todos los integrantes en mayor o menor medida, 
contribuyan en el desarrollo de todas las partes del código para que 
nadie quede en desconocimiento de lo que se hizo en cada sección. 
Si bien cada parte del código está comenazada por diferentes integrantes (parseo
de los argumentos, lectura de los ficheros, etc), todos nos 
familiarizamos con cada una de estas partes y cumplimos la función 
de testers de lo hecho por otros integrantes. 
\item Se propuso como meta paralela, hacer el programa lo mas reutilizable
posible tratando de que los métodos desarrollados, sean los suficientemente
modulares como para su posible reutilización en los TPs venideros. 
\item Debido desconocimiento de \LaTeX{} \cite{latex} para algunos 
integrantes del grupo, uno de los integrantes dió una breve introducción 
de como desarrollar este informe para que todos pudiésen modificarlo y agregar lo que considerase
necesario. Para compilar el archivo del informe se usaron el compilador
de \LaTeX{} \cite{latex} propio que viene en el Linux, y en el caso que sea necesario
compilar el informe en un Windows se uso el \htmladdnormallink{MIKTEX}{http://miktex.org/}
el cuál es una implementación del compilador de \LaTeX{} \cite{latex} para dicha plataforma.
\item Para poder generar el código assembler a partir del código fuente, 
dentro de NETBSD se utilizó gcc con la siguiente opción: 
\begin{tabbing}
------- \= ----- \= \kill
\> \textbf{\emph{gcc -S -Wall -O0 Definitions.c -mrnames}}\\ 
\> \textbf{\emph{gcc -S -Wall -O0 Message.c -mrnames}}\\ 
\> \textbf{\emph{gcc -S -Wall -O0 Process\_File.c -mrnames}}\\ 
\> \textbf{\emph{gcc -S -Wall -O0 Process\_Stdin.c -mrnames}}\\ 
\> \textbf{\emph{gcc -S -Wall -O0 Stack.c -mrnames}}\\
\> \textbf{\emph{gcc -S -Wall -O0 tp0.c -mrnames}}\\ 
\end{tabbing}
\item Para crear el presente informe en formato PDF usando \LaTeX{} \cite{latex}
en Linux, ingresar los siguientes comandos:
\begin{tabbing}
------- \= ----- \= \kill
\> \textbf{\emph{\$ latex tp0.tex}}\\ 
\> \textbf{\emph{\$ bibtex tp0.aux}}\\ 
\> \textbf{\emph{\$ latex tp0.tex}}\\ 
\> \textbf{\emph{\$ latex tp0.tex}}\\ 
\> \textbf{\emph{\$ dvipdfm tp0.dvi}}\\ 
\end{tabbing}
\item PAra observar el documento sin necesidad de tener que crear 
el PDF con dvipdfm, ingresar:
\begin{tabbing}
------- \= ----- \= \kill
\> \textbf{\emph{\$ xdvi tp0.dvi}}\\ 
\end{tabbing}
\end{enumerate}

\subsection{{\normalsize Screenshots}}

\begin{enumerate}
\item NetBSD corriendo
\begin{center}
\includegraphics[width=110mm,height=80mm]{Net_BSD_Corriendo.png}
\end{center}
\newpage{}
\item Túnel SSH
\item Linux a NetBSD
\begin{center}
\includegraphics[width=110mm,height=80mm]{Pasarde_Linux_a_NetBsd.png}
\end{center}
\item NetBsd a Linux
\begin{center}
\includegraphics[width=110mm,height=80mm]{Copiar_de_NetBsd_a_Linux.png}
\end{center}
\newpage{}
\item Programa compilado y corriendo en NetBSD
\item Mensaje de ayuda
\begin{center}
\includegraphics[width=110mm,height=80mm]{help_msg.png}
\end{center}
\item Mensaje de Versión
\begin{center}
\includegraphics[width=110mm,height=80mm]{Version_Msg.png}
\end{center}
\newpage{}
\item Pruebas
\item Archivo Alumnos.txt
\begin{center}
\includegraphics[width=110mm,height=80mm]{Prueba_1.png}
\end{center}
\item Varios Archivos
\begin{center}
\includegraphics[width=110mm,height=80mm]{Prueba_varios_archivos.png}
\end{center}
\newpage{}
\item Stdin y Archivos
\begin{center}
\includegraphics[width=110mm,height=80mm]{Varios_Archivos_y_Stdin.png}
\end{center}
\item Solo Stdin
\begin{center}
\includegraphics[width=110mm,height=80mm]{Solo_Stdin.png}
\end{center}
\newpage{}
\item Errores
\item Archivo regular.
\begin{center}
\includegraphics[width=110mm,height=80mm]{No_Reg_File.png}
\end{center}
\newpage{}
\item Archivo inexistente.
\begin{center}
\includegraphics[width=110mm,height=80mm]{No_Existe_Archivo.png}
\end{center}
\item Mala Invocación.
\begin{center}
\includegraphics[width=110mm,height=80mm]{Mala_Invocacion.png}
\end{center}
\newpage{}
\item Código assembler
\begin{center}
\includegraphics[width=110mm,height=80mm]{Generar_Assembler.png}
\end{center}
\end{enumerate}

\newpage{}
\section{{\normalsize Conclusiones}}

\begin{enumerate}
\item Si bien el lo solicitado por el programa no era excesivamente difícil,
la realización completa del TP llevó cierta dificultad al tener que
realizarlo en el contexto solicitado: alta portabilidad, desarrollo
en C, e informe hecho en \LaTeX{} \cite{latex}. 
\item En el primer caso la dificultad radicaba en tener configurado 
y funcionando el GXEmul dentro de un Linux, y lograr que en ambos casos 
el programa compile y corra sin problemas. 
\item Debido a nuestro desconocimiento con \LaTeX{} \cite{latex}, tuvimos que 
invertir tiempo en encontrar forma de realizar el presente documento 
de la manera más correcta posible 
\item En cuanto al trabajo grupal en si mismo, no hubo inconvenientes de
ningún tipo ya que al ser el grupo relativamente chico y tener conocimiento
del manejo del versionado de un proyecto ante cambios ingresado por
los integrantes (por medio del SVN), la introducción de modificaciones
y correcciones fué fluida. 
\end{enumerate}
\section{{\normalsize 2º Entrega}}
\subsection{{\normalsize Pruebas}}
El conjunto de pruebas se escribieron en un script de linux adjunto en la 
siguiente sección. La mayoria de las pruebas se basan en comparar la salida 
de nuestro programa con el comando tac. Para el caso de NetBSD, al no 
encontrarse el comando tac se optó por hacer una doble ejecucion del tp y 
comparar la salida con el archivo original. A continuación se comentan cada uno:\\\\

Opción de ayuda:\\
\textbf{\$tp0 -h\\
Usage: \\
	tp0 -h\\
	tp0 -V\\
	tp0 [file ...]\\
Options:\\
	-V, --version	Print version and quit\\
	-h, --help	Print this information and quit\\\\
}
Opción de versión:\\
\textbf{
\$tp0 -V\\
Version 1.1 - Integrantes del Grupo: Martinez, Ariel, Ali, Luis, Dworjanyn Enrique\\\\
}
Un archivo vacío:\\
\textbf{
\$tp0 vacio.txt \\\\}
Ejemplo básico con un archivo de 2 lineas:\\
\textbf{\$./tp0 2Lineas.txt\\
}\\\\
Archivo con lineas y saltos:\\
\textbf{\$./tp0 lineasYsaltos.txt\\
}\\\\
Archivo con 2 lineas excesivamente largas:\\
\textbf{
\$tp0 2lineasLargas.txt \\\\}

Archivo inexistente:\\
\textbf{
\$tp0 archivoInexistente.txt \\\\}

Recibe dos archivos como parámetros:\\
\textbf{\$./tp0 2Lineas.txt lineasYsaltos.txt\\
}\\

Un conjunto de 10 pruebas de archivos binarios aleatorios utilizando /etc/dev/urandom\\\\

\section{{\normalsize Tercer Entrega}}
\subsection{{\normalsize Pruebas}}
Se modificó el script de pruebas. En este caso existen 2 script, cuyo funcionamiento se
detalla a continuación:\\

\textbf{\emph{generar\_pruebas\_y\_res.sh}}\\

Este script en primera instancia verifica la existencia de ciertos directorios para
poder volcar el resultado. Si no existen, los crea. Estos directrios son:\\
\begin{tabular}{ l c r }
Casos\_de\_prueba & Salida & Salida\_Esperada\\
Casos\_de\_prueba/binario & Salida/Binario & Salida\_Esperada/Binario\\
Casos\_de\_prueba/Texto & Salida/Texto & Salida\_Esperada/Texto\\
\end{tabular}

Una vez creado los directorios, el script  genera archivos binarios en la carpeta\\
Casos\_de\_prueba/binario. Estos archivos son de distintos tamaños que van desde\\
0 kb a 10 kb. El usuario se debe encargar de poner \"a mano\" los archivos\\
que el mismo genera para hacer pruebas, en la carpeta Casos\_de\_prueba/Texto.\\
A Continuación el script ejecuta el comando tac para los archivos que estan en\\
Casos\_de\_prueba/binario redirigiendo la salida del tac a un archivo con el mismo\\
nombre que el archivo de entrada del tac pero agregando .ref al final. Este archivo
queda guardado en la carpeta Salida\_Esperada/Binario.\\
De la misma forma, el script ejecuta el comando tac sobre los archivos de la carpeta\\
Casos\_de\_prueba/Texto y vuelca los archivos (resultado de aplicar tac a cada uno), en la 
carpeta Salida\_Esperada/Texto.\\

Una vez hecho esto, se debe copiar a NetBSD por medio del tunel SSH, las carpetas (con
 todo su contenido) Casos\_de\_prueba, Salida y Salida\_Esperada, y el archivo test.sh\\

\textbf{\emph{\$./test.sh}}\\

Este script se encarga de ejecutar el tp pasando a los archivos de la carpeta\\
Casos\_de\_prueba/binario y Casos\_de\_prueba/Texto tanto por stdin como por argumento.\\
Lo que imprime el tp por stdout se redirige a un archivo a la carpeta Salida/Binario
o Salida/Texto, según corresponda.\\
Una vez hecho esto el script simplemente compara (usando el comando diff ) al arhivo que 
esta en Salida/binario (o /Texto) con el que corresponde a la salida del tac que se encuentra 
en Salida\_Esperada/Binario (o /Texto).\\
Se van listando los archivos a medida que la salida del tp para los mismos coincide con la 
salida del tac. Si alguno tiene diferencia, se indica que el archivo falló y el script finaliza
su ejecución.\\
Cabe aclarar que para que este script funcione, el nombre del ejecutable que se crea al compilar
los fuentes del tp se debe llamar \textbf{\emph{tp0}}\\
\subsection{Conclusiones}
Se corregieron solamente 2 errores en el código (2 errores con respecto a la primer entrega)
para que todas las pruebas sean satisfactorias. \\
Cuando se procesaba la entrada estándar, se estaba agregando un $\backslash$0 al final de un puntero a char, 
dado que la función printf imprime hasta encontrar un $\backslash$0 . Al no poner $\backslash$0, imprimia la linea con \\
un resto de basura y la entrada no coincidia. (Este error estaba en el archivo Process\_Stdin en 
el método sowh\_all\_lines.) Cuando se procesaba un archivo cuyo nombre se indicaba por argumento, \\
se estaba usando como fin de lina tanto $\backslash$n como $\backslash$0.\\
Usando solo $\backslash$n pasaron todas las pruebas.\\

\bibliographystyle{plain}
\bibliography{bibliografia}
\nocite{*}
\end{document}
